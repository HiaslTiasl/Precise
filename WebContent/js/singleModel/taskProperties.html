<div class="form-horizontal">
	<div class="form-group">
		<label for="id" class="col-sm-4 control-label">ID</label>
		<div class="col-sm-8">
			<span id="id" class="form-control field-id">
				#{{$ctrl.resource.data.id}}
			</span>
		</div>
	</div>
	<div class="form-group">
		<label for="workers" class="col-sm-4 control-label">Workers needed</label>
		<div class="col-sm-8">
			<input id="workers"
				type="number"
				class="form-control field-workers"
				ng-model="$ctrl.resource.data.numberOfWorkersNeeded"/>
		</div>
	</div>
	<div class="form-group">
		<label for="duration" class="col-sm-4 control-label">Expected duration</label>
		<div class="col-sm-8">
			<div class="input-group">
				<input id="duration"
					type="number"
					class="form-control"
					ng-model="$ctrl.resource.data.durationDays"/>
				<span class="input-group-addon">days</span>
			</div>
		</div>
	</div>
	<div class="form-group">
		<label for="duration-hours" class="col-sm-4 control-label">Working hours</label>
		<div class="col-sm-8">
			<p id="duration-hours" class="form-control-static">
				{{$ctrl.resource.data.durationHours}} h
			</p>
		</div>
	</div>
	<div class="form-group">
		<label for="units-per-day" class="col-sm-4 control-label">Units/day</label>
		<div class="col-sm-8">
			<span id="units-per-day" class="form-control field-units-per-day">
				{{$ctrl.resource.data.unitsPerDay | number}}
				<sup>u</sup>&frasl;<sub>d</sub>
			</span>
		</div>
	</div>
	<div class="form-group">
		<label for="craft" class="col-sm-4 control-label">Craft</label>
		<div class="col-sm-8">
			<p id="craft" class="form-control field-craft">
				{{$ctrl.resource.data.type | withShortName:'craft':'craftShort'}}
			</p>
		</div>
	</div>
	<div class="form-group">
		<label for="phase" class="col-sm-4 control-label">Phase</label>
		<div class="col-sm-8">
			<p id="phase" class="form-control-static">
				{{$ctrl.resource.data.type.phase.name}}
			</p>
		</div>
	</div>
	<div class="form-group">
		<label for="type" class="col-sm-4 control-label">Definition</label>
		<div class="col-sm-8">
			<p id="type" class="form-control-static">
				{{$ctrl.resource.data.type.name}}
			</p>
		</div>
	</div>
	<fieldset>
		<legend>Exclusiveness</legend>
		<div class="form-group">
			<label for="exclusiveness-type" class="col-sm-4 control-label">Type</label>
			<div id="exclusiveness-type" class="col-sm-8">
				<div class="radio" ng-repeat="st in $ctrl.scopeTypes">
					<label>
						<input
							type="radio"
							ng-model="$ctrl.exclusiveness.type"
							ng-value="st"
							ng-change="$ctrl.updateExclusivenessAttributes()"/>
						{{st.displayName}}
					</label>
				</div>
			</div>
		</div>
		<div class="form-group">
			<label for="exclusiveness-attributes" class="col-sm-4 control-label">Attributes</label>
			<div class="col-sm-8">
				<div class="row">
					<div class="checkbox col-sm-6" ng-repeat="attr in $ctrl.resource.data.type.phase.attributes">
						<label>
							<input type="checkbox"
								ng-model="$ctrl.exclusiveness.attributes[attr.name]"
								ng-change="$ctrl.updateExlusivenessType()">
								{{attr.name}}
						</label>
					</div>
				</div>
			</div>
		</div>
	</fieldset>
	<fieldset>
		<legend>Order</legend>
		<div class="toolbar">
			<button
				class="btn btn-primary btn-xs"
				ng-click="$ctrl.addOrderSpec()"
				ng-disabled="!$ctrl.canAddOrderSpec()">
				<span class="glyphicon glyphicon-plus"></span>
			</button>
		</div>
		<table id="location-table" class="table table-striped" st-table="orderSpecs" st-safe-src="$ctrl.order.specs">
			<thead>
				<tr>
					<th>Attribute</th>
					<th>Order Type</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="o in orderSpecs track by $index">
					<td>
						<a href
							editable-select="o.attribute"
							buttons="no"
							e-ng-options="a as a.name for a in $ctrl.resource.data.type.phase.attributes | filter:$ctrl.attrFilterForOrderSpec(o):true track by a.name"
							onbeforesave="$ctrl.selectedOrderSpecAttribute($data, o.attribute)">
							{{ o.attribute.name || '----'}}
						</a>
					</td>
					<td>
						<a href
							editable-select="o.orderType"
							buttons="no"
							e-ng-options="t as t.displayName disable when $ctrl.isDisabledOrderType(t, o.attribute) for t in $ctrl.orderTypes">
							{{ o.orderType.displayName }}
						</select>
					</td>
					<td>
						<button
							class="btn btn-default btn-xs"
							ng-click="$ctrl.moveUpOrderSpec($index)"
							ng-disabled="!$ctrl.canMoveUpOrderSpec($index)">
							<span class="glyphicon glyphicon-chevron-up"></span>
						</button>
						<button
							class="btn btn-default btn-xs"
							ng-click="$ctrl.moveDownOrderSpec($index)"
							ng-disabled="!$ctrl.canMoveDownOrderSpec($index)">
							<span class="glyphicon glyphicon-chevron-down"></span>
						</button>
						<button
							class="btn btn-danger btn-xs"
							ng-click="$ctrl.removeOrderSpec($index)">
							<span class="glyphicon glyphicon-trash"></span>
						</button>
					</td>
				</tr>
			</tbody>
		</table>
	</fieldset>
	<fieldset>
		<legend>Locations</legend>
		<div class="toolbar">
			<a href ng-click="$ctrl.addPattern()">
				<span class="glyphicon glyphicon-plus"></span>
			</a>
		</div>
		<table id="location-table" class="table table-striped" st-table="locs" st-safe-src="$ctrl.resource.data.locationPatterns">
			<thead>
				<tr>
					<th ng-repeat="attr in $ctrl.resource.data.type.phase.attributes">{{::attr.name}}</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="pattern in locs track by $index" ng-init="patternNum = $index">
					<td ng-repeat="attr in $ctrl.resource.data.type.phase.attributes track by $index">
						<a href
							editable-select="pattern[attr.name].value"
							e-ng-options="value for value in pattern[attr.name].allowedValues"
							ng-class="{disabled: $ctrl.isDisabledPatternEntry(pattern[attr.name])}"
							ng-disabled="$ctrl.isDisabledPatternEntry(pattern[attr.name])"
							buttons="no"
							onbeforesave="$ctrl.updatePattern(pattern, patternNum, attr, $data)">
							{{ pattern[attr.name].value }}
						</a>
					</td>
					<td>
						<a href ng-click="$ctrl.removePattern(patternNum)">
							<span class="glyphicon glyphicon-trash"></span>
						</a>
					</td>
				</tr>
			</tbody>
		</table>
	</fieldset>
</div>
<div class="text-right">
	<button class="btn btn-primary"
		ng-click="$ctrl.sendTask()"
		ng-disabled="!$ctrl.resource.data.type">
		Done
	</button>
	<button class="btn btn-default" ng-click="$ctrl.cancel()">Cancel</button>
</div>
